# Message Bus Proxy Requirements

## Overview

The Message Bus Proxy is what the MessageBus Java class will use to publish messages
onto the native message bus. This Message Bus Proxy will be built as a dynamic library
and loaded by the Java class using `System.loadLibrary(...)`. The path to the .dll or
.so must be included in the `library_path` of the configuration for the java module host.

## References
[JNI](http://docs.oracle.com/javase/8/docs/technotes/guides/jni/)

## Exposed API
```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_microsoft_azure_gateway_core_MessageBus */

#ifndef _Included_com_microsoft_azure_gateway_core_MessageBus
#define _Included_com_microsoft_azure_gateway_core_MessageBus
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_microsoft_azure_gateway_core_MessageBus
 * Method:    publishMessage
 * Signature: (J[B)I
 */
JNIEXPORT jint JNICALL Java_com_microsoft_azure_gateway_core_MessageBus_publishMessage
  (JNIEnv *, jobject, jlong, jbyteArray);

#ifdef __cplusplus
}
#endif
#endif
```

##Java_com_microsoft_azure_gateway_core_MessageBus_publishMessage
```C
JNIEXPORT jint JNICALL Java_com_microsoft_azure_gateway_core_MessageBus_publishMessage(JNIEnv *, jobject, jlong, jbyteArray);
```
This function is called when a call to `private native int MessageBus_Publish(long addr, Message message);`
is made in the MessageBus Java class.

**SRS_JAVA_MESSAGE_14_001: [** The function shall cast `addr` as a `MESSAGE_BUS_HANDLE`. **]**

**SRS_JAVA_MESSAGE_14_002: [** The function shall find the `jclass` of the `message` parameter. **]**

**SRS_JAVA_MESSAGE_14_003: [** The function shall use the found `jclass` to get the method ID for the `Message` serialization method. **]**

**SRS_JAVA_MESSAGE_14_004: [** The function shall invoke the serialization method on the `message` and convert the resulting `byte[]` to `const unsigned char*`. **]**

**SRS_JAVA_MESSAGE_14_005: [** The function shall create a new `MESSAGE_HANDLE` using the byte array.**]**

**SRS_JAVA_MESSAGE_14_006: [** The function shall call `MessageBus_Publish` using the `MESSAGE_BUS_HANDLE` and the message. **]**

**SRS_JAVA_MESSAGE_14_007: [** The function shall return the result from the call to `MessageBus_Publish`. **]**

**SRS_JAVA_MESSAGE_14_008: [** If any JNI function call fails, the function shall return a negative value. **]**